# ===========================================
# APPLICATION CONFIGURATION
# ===========================================
spring.application.name=bacoge-construction-material
spring.profiles.active=dev
server.port=8081
server.servlet.context-path=/
server.servlet.session.timeout=30m

# ===========================================
# DATABASE CONFIGURATION
# ===========================================
spring.datasource.url=jdbc:mysql://localhost:3306/bacoge?createDatabaseIfNotExist=true&enabledTLSProtocols=TLSv1.2&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=admin

# HikariCP connection pool
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1200000

# ===========================================
# JPA/HIBERNATE CONFIGURATION
# ===========================================
spring.jpa.hibernate.ddl-auto=update 
spring.jpa.show-sql=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=false
spring.jpa.properties.hibernate.session.events.log.LOG_QUERIES_SLOWER_THAN_MS=25

# Logging configuration is defined in the LOGGING CONFIGURATION section below

# ===========================================
# FLYWAY CONFIGURATION
# ===========================================
spring.flyway.locations=classpath:db/migration
spring.flyway.enabled=false
spring.flyway.validate-on-migrate=true

# ===========================================
# MVC & Static Resources
# ===========================================
# NOTE: In Spring Boot 3.x, AntPathMatcher is no longer supported as a matching strategy.
# The default PathPatternParser is used automatically, so we remove the old setting to avoid binding errors.
# spring.mvc.pathmatch.matching-strategy=ant_path_matcher
spring.mvc.static-path-pattern=/**
spring.mvc.throw-exception-if-no-handler-found=true
spring.mvc.favicon.enabled=true

spring.web.resources.static-locations=classpath:/static/,classpath:/public/,classpath:/resources/,classpath:/META-INF/resources/
spring.web.resources.add-mappings=true
spring.web.resources.cache.period=3600

spring.web.resources.cache.cachecontrol.max-age=3600
spring.web.resources.cache.cachecontrol.must-revalidate=true
spring.web.resources.cache.cachecontrol.no-cache=false
spring.web.resources.chain.cache=true
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**
spring.web.resources.chain.strategy.fixed.enabled=true
spring.web.resources.chain.strategy.fixed.paths=/js/**,/css/**,/images/**,/fonts/**
spring.web.resources.chain.strategy.fixed.version=1.0

# ===========================================
# FILE UPLOAD & STORAGE CONFIGURATION
# ===========================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=15MB
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.resolve-lazily=false

app.images.upload-dir=./uploads/images/
# Use a stable absolute directory for uploads so files persist across restarts
# Both FileStorageService and FileStorageConfig read this property
app.upload.dir=./uploads


# Switched to Local AI (Ollama)
openai.api.key=ollama
openai.model=mistral
openai.api.url=http://localhost:11434/v1/chat/completions

# Backup of Real OpenAI Config
# openai.api.key=YOUR_OPENAI_API_KEY
# openai.model=gpt-3.5-turbo
# openai.api.url=https://api.openai.com/v1/chat/completions
app.images.max-size=5242880
app.images.allowed-extensions=jpg,jpeg,png,gif,webp
app.images.thumbnail.width=200
app.images.thumbnail.height=200

# ===========================================
# JWT CONFIGURATION
# ===========================================
# WARNING: For production, use environment variables for secrets
app.jwt.secret=${JWT_SECRET:MyVerySecureJwtSecretKeyForHS512Algorithm123456789012345678901234}
app.jwt.expiration-ms=${JWT_EXPIRATION_MS:86400000}
app.jwt.refresh-expiration-ms=${JWT_REFRESH_EXPIRATION_MS:604800000}

# ===========================================
# EMAIL CONFIGURATION
# ===========================================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME:contact@example.com}
spring.mail.password=${MAIL_PASSWORD:your_password_here}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.default-encoding=UTF-8

app.mail.from=${spring.mail.username}
app.mail.from-name=Bacoge Construction Material

# ===========================================
# ACTUATOR CONFIGURATION
# ===========================================
management.health.mail.enabled=false
management.health.defaults.enabled=true
management.health.db.enabled=true
management.health.diskspace.enabled=true
management.health.ping.enabled=true

# ===========================================
# MAIL CONFIGURATION
# ===========================================
spring.mail.test-connection=false

# ===========================================
# CACHE CONFIGURATION
# ===========================================
spring.cache.type=caffeine
spring.cache.cache-names=products,categories,users,materials,suppliers
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=600s,recordStats

# ===========================================
# CORS CONFIGURATION
# ===========================================
# Note: CORS configuration is now handled in WebMvcConfig and SecurityConfig
# to properly handle both Spring MVC and Spring Security CORS configurations
app.cors.allowed-origins=http://localhost:5173,http://127.0.0.1:5173,http://localhost:8080,http://127.0.0.1:8080

# ===========================================
# LOGGING CONFIGURATION
# ===========================================
logging.level.root=INFO
logging.level.com.bacoge=DEBUG
logging.level.com.bacoge.constructionmaterial=DEBUG
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.springframework.data.jpa=DEBUG
logging.level.org.springframework.web.servlet.DispatcherServlet=WARN
logging.level.org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver=WARN
logging.level.org.springframework.web.servlet.resource=WARN
logging.level.org.thymeleaf=INFO
logging.level.org.attoparser=WARN
logging.level.org.hibernate.validator=WARN

logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n
logging.logback.rollingpolicy.file-name-pattern=logs/bacoge-app.%d{yyyy-MM-dd}.%i.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.total-size-cap=100MB
logging.logback.rollingpolicy.max-history=30

# ===========================================
# MONITORING & METRICS
# ===========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=always
management.info.env.enabled=true
management.prometheus.metrics.export.enabled=true

# ===========================================
# ERROR HANDLING
# ===========================================
spring.main.allow-bean-definition-overriding=true
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on-param

# ===========================================
# APPLICATION BUSINESS CONFIGURATION
# ===========================================
app.name=Bacoge Interior Design
app.version=1.0.0
app.description=Application de vente de design d'int√©rieur
app.contact.email=contact@bacoge.com
app.contact.phone=+216-XX-XXX-XXX

app.currency=EURO
app.tax-rate=18.0
app.max-discount-percentage=50

app.pagination.default-size=20
app.pagination.max-size=100

app.notifications.enabled=true
app.notifications.email.enabled=true
app.notifications.sms.enabled=false

# ===========================================
# SECURITY CONFIGURATION
# ===========================================
app.security.password.minLength=8
app.security.password.requireUppercase=true
app.security.password.requireLowercase=true
app.security.password.requireDigit=true
app.security.password.requireSpecialChar=true

app.security.login.max-attempts=5
app.security.login.lockout-duration=300000